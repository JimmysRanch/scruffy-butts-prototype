<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Scruffy Butts</title>

  <!-- PWA -->
  <meta name="theme-color" content="#111111" />
  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Scruffy Butts" />
  <link rel="apple-touch-icon" href="icon-180.png" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .safe-top { padding-top: max(env(safe-area-inset-top), 12px); }
  </style>
</head>
<body class="bg-white text-zinc-900">
  <div id="app" class="min-h-screen"></div>

  <script>
    /********** seed + state (same as before, trimmed) **********/
    const KEY="sb_state_v1";
    const S = JSON.parse(localStorage.getItem(KEY) || "null") || {
      services:[], employees:[], clients:[], pets:[], appointments:[], messages:[], seeded:false
    };
    const uid = () => Math.random().toString(36).slice(2);
    function save(){ localStorage.setItem(KEY, JSON.stringify(S)); }
    function seed(){
      if (S.seeded) return;
      S.services = [
        { id: uid(), name: 'Bath & Brush', price: 35, duration: 45, pct: 40 },
        { id: uid(), name: 'Full Groom (Small)', price: 65, duration: 75, pct: 50 },
        { id: uid(), name: 'Full Groom (Medium)', price: 85, duration: 90, pct: 50 },
        { id: uid(), name: 'Deshedding Add-on', price: 20, duration: 15, pct: 30 },
      ];
      S.employees = [
        { id: uid(), name: 'Taylor', role:'stylist', schedule:{1:[9,17],3:[9,17],5:[9,15]} },
        { id: uid(), name: 'Jordan', role:'stylist', schedule:{2:[10,18],4:[10,18]} },
      ];
      S.clients = [
        { id: uid(), name: 'Sarah Jones',  phone:'+12105550001' },
        { id: uid(), name: 'Emily Wilson', phone:'+12105550002' },
        { id: uid(), name: 'David Smith',  phone:'+12105550003' },
      ];
      S.pets = [
        { id: uid(), clientId:S.clients[0].id, name:'Rocky' },
        { id: uid(), clientId:S.clients[1].id, name:'Bella' },
        { id: uid(), clientId:S.clients[2].id, name:'Luna'  },
      ];
      const t=new Date(); t.setHours(9,0,0,0);
      S.appointments = [
        mkAppt(S.clients[0], S.pets[0], S.services[2], S.employees[0], t),
        mkAppt(S.clients[1], S.pets[1], S.services[0], S.employees[1], new Date(t.getTime()+3*3600000)),
        mkAppt(S.clients[2], S.pets[2], S.services[1], S.employees[0], new Date(t.getTime()+6*3600000)),
      ];
      S.messages = [{ id:uid(), body:"Hi! Can I book Friday at 10?", sentAt:new Date().toISOString() }];
      S.seeded = true; save();
    }
    function mkAppt(c,p,s,e,start){
      return { id:uid(), clientId:c.id, petId:p.id, serviceId:s.id, employeeId:e.id,
               start:start.toISOString(), end:new Date(start.getTime()+s.duration*60000).toISOString(),
               status:'booked' };
    }

    /********** tiny DOM helpers **********/
    const $ = s => document.querySelector(s);
    function el(tag, props={}, ...kids){
      const n=document.createElement(tag);
      Object.entries(props).forEach(([k,v])=>{
        if(k==='class') n.className=v; else if(k==='html') n.innerHTML=v;
        else if(k.startsWith('on')) n.addEventListener(k.slice(2).toLowerCase(),v);
        else n.setAttribute(k,v);
      });
      kids.flat().forEach(c => n.appendChild(c?.nodeType?c:document.createTextNode(c??"")));
      return n;
    }

    /********** Router **********/
    let TAB = 'dashboard'; // default to dashboard look
    function setTab(t){ TAB=t; render(); }

    /********** Sidebar **********/
    function Sidebar(){
      const Item = (id, label, icon) => el('button', {
        class:`w-full flex items-center gap-3 px-3 py-2 rounded-xl text-left
               ${TAB===id?'bg-white/90 text-zinc-900 shadow':'text-white/90 hover:bg-white/10'}`,
        onclick:()=>setTab(id)
      }, el('span',{class:'text-lg'},icon), el('span',{},label));

      return el('aside',{class:'w-[240px] shrink-0 bg-gradient-to-b from-sky-600 to-blue-600 text-white p-4 space-y-4 hidden md:block'},
        el('div',{class:'flex items-center gap-3'},
          el('img',{src:'icon-180.png', class:'w-12 h-12 rounded-xl', alt:''}),
          el('div',{},
            el('div',{class:'font-extrabold text-xl leading-5'},'Scruffy Butts'),
            el('div',{class:'text-xs text-white/80 -mt-0.5'},'Natalia, TX')
          )
        ),
        el('nav',{class:'space-y-2 pt-2'},
          Item('dashboard','Dashboard','🏠'),
          Item('book','Appointments','📅'),
          Item('clients','Clients','👤'),
          Item('messages','Messages','💬'),
          Item('admin','Reports','📊'),
          Item('agreement','Agreement','✍️'),
          Item('calendar','Calendar','🗓️'),
        )
      );
    }

    /********** Dashboard **********/
    function fmtTime(iso){ return new Date(iso).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}); }
    function KPI(label, value, icon){
      return el('div',{class:'rounded-2xl border border-zinc-200 bg-white p-4 flex items-center gap-3 shadow-sm'},
        el('div',{class:'text-2xl'},icon),
        el('div',{},
          el('div',{class:'text-xs text-zinc-500'},label),
          el('div',{class:'font-bold text-xl'}, value)
        )
      );
    }
    function AppointmentsCard(){
      const today = new Date().toISOString().slice(0,10);
      const appts = S.appointments.filter(a=>a.start.slice(0,10)===today).sort((a,b)=>a.start.localeCompare(b.start));
      const Row = a => {
        const pet = S.pets.find(p=>p.id===a.petId)?.name || 'Pet';
        const dot = {booked:'bg-sky-500', complete:'bg-emerald-500', canceled:'bg-rose-500'}[a.status] || 'bg-zinc-400';
        return el('div',{class:'flex items-center justify-between py-1'},
          el('div',{class:'flex items-center gap-2'},
            el('span',{class:`inline-block w-2 h-2 rounded-full ${dot}`}),
            el('span',{},pet)
          ),
          el('div',{class:'text-sm text-zinc-700'}, fmtTime(a.start))
        );
      };
      return Card('Appointments', el('div',{class:'divide-y divide-zinc-100'},
        ...appts.map(Row),
        !appts.length && el('div',{class:'text-sm text-zinc-500 py-2'},'No appointments today.')
      ), 'bg-pink-500 text-white');
    }
    function PromoCard(){
      return Card('Upcoming Services',
        el('div',{class:'flex items-center gap-3'},
          el('div',{class:'w-28 h-20 rounded-xl bg-sky-100 flex items-center justify-center'},'🐶'),
          el('div',{},
            el('div',{class:'font-semibold'},'Full Grooming'),
            el('div',{class:'text-sm text-zinc-500'},'2:00 PM')
          )
        )
      );
    }
    function CustomersCard(){
      const names = ['Sarah Jones','Emily Wilson','David Smith','Emily Wilson','Michael Brown','David Smith'];
      const grid = el('div',{class:'grid grid-cols-2 gap-x-6 gap-y-1 text-sm'},
        ...names.map(n=>el('div',{},n))
      );
      return Card('Customer List', grid);
    }
    function ReportsCard(){
      // tiny bar chart (SVG)
      const vals=[120,180,220,300,420];
      const max=Math.max(...vals);
      const bars = vals.map((v,i)=>el('rect',{x: i*26+24, y: 120 - (v/max)*100, width:20, height:(v/max)*100, rx:4, class:'fill-sky-400'}));
      const svg = el('svg',{viewBox:'0 0 170 130', class:'w-full h-28'}, 
        el('rect',{x:0,y:0,width:170,height:130, class:'fill-white'}),
        ...bars,
        el('text',{x:24,y:126,class:'fill-zinc-400 text-[10px]'},'Jan'),
        el('text',{x:50,y:126,class:'fill-zinc-400 text-[10px]'},'Feb'),
        el('text',{x:76,y:126,class:'fill-zinc-400 text-[10px]'},'Mar'),
        el('text',{x:102,y:126,class:'fill-zinc-400 text-[10px]'},'Apr'),
        el('text',{x:128,y:126,class:'fill-zinc-400 text-[10px]'},'May'),
      );
      return Card('Reports', svg);
    }
    function Card(title, body, headerClass=''){
      return el('div',{class:'rounded-2xl border border-zinc-200 bg-white shadow-sm overflow-hidden'},
        el('div',{class:`px-4 py-2 font-semibold ${headerClass || 'bg-pink-100 text-pink-900'}`}, title),
        el('div',{class:'p-4'}, body)
      );
    }
    function Dashboard(){
      const todayCount = S.appointments.filter(a=>a.start.slice(0,10)===new Date().toISOString().slice(0,10)).length;
      return el('div',{class:'flex-1 p-4 md:p-6'},
        el('h1',{class:'text-3xl font-extrabold mb-4'},'Dashboard'),
        el('div',{class:'grid sm:grid-cols-4 gap-3 mb-4'},
          KPI("Today's Appointments", todayCount,'📅'),
          KPI('New Clients', 8,'👤'),
          KPI('Completed', '$850','✅'),
          KPI('Upcoming Services', 7,'✅')
        ),
        el('div',{class:'grid lg:grid-cols-2 gap-4'},
          el('div',{class:'grid gap-4'},
            AppointmentsCard(),
            CustomersCard()
          ),
          el('div',{class:'grid gap-4'},
            PromoCard(),
            ReportsCard()
          )
        )
      );
    }

    /********** Other screens (quick stubs linking to your existing flows) **********/
    function Simple(title, text){
      return el('div',{class:'flex-1 p-4 md:p-6'},
        el('h1',{class:'text-3xl font-extrabold mb-4'}, title),
        el('p',{class:'text-zinc-600'}, text)
      );
    }

    /********** Layout **********/
    function App(){
      return el('div',{class:'min-h-screen flex'},
        Sidebar(),
        (TAB==='dashboard') ? Dashboard() :
        (TAB==='book')      ? Simple('Appointments','Use the Book/Calendar flows we already built.') :
        (TAB==='clients')   ? Simple('Clients','Browse and manage clients (coming from your data).') :
        (TAB==='messages')  ? Simple('Messages','Two-way texting demo.') :
        (TAB==='admin')     ? Simple('Reports','Payroll & schedules.') :
        (TAB==='agreement') ? Simple('Agreement','Digital consent & signature.') :
        Simple('Calendar','See scheduled appointments.')
      );
    }

    /********** mount **********/
    seed();
    function render(){ const root=$('#app'); root.innerHTML=''; root.appendChild(App()); }
    render();

    // PWA worker (optional if you already have sw.js + manifest)
    if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js').catch(()=>{});
  </script>
</body>
</html>
