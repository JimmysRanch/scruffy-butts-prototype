<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Scruffy Butts Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- React and Babel from CDN -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        nav {
            background-color: #f2f2f2;
            padding: 10px;
            display: flex;
            gap: 10px;
        }
        nav button {
            background-color: #ddd;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
        }
        nav button.active {
            background-color: #bbb;
        }
        .container {
            padding: 16px;
        }
        h1,
        h2 {
            margin-top: 0;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 400px;
        }
        form select,
        form input {
            padding: 6px;
            font-size: 1rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table th,
        table td {
            padding: 8px;
            border: 1px solid #ccc;
            text-align: left;
        }
        .chat-box {
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 8px;
            margin-bottom: 10px;
        }
        .message {
            margin-bottom: 8px;
        }
        .message.sent {
            text-align: right;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        // Data definitions
        const initialServices = [
            { id: 1, name: 'Bath & Brush', price: 35, duration: 45, commission: 40 },
            { id: 2, name: 'Full Groom (Small)', price: 65, duration: 75, commission: 50 },
            { id: 3, name: 'Full Groom (Medium)', price: 85, duration: 90, commission: 50 },
            { id: 4, name: 'Deshedding Add-on', price: 20, duration: 15, commission: 30 },
        ];

        const initialEmployees = [
            {
                id: 1,
                name: 'Taylor',
                phone: '+12105550101',
                role: 'stylist',
                commission: 50,
                schedule: { 1: { open: 9, close: 17 }, 3: { open: 9, close: 17 }, 5: { open: 9, close: 15 } },
            },
            {
                id: 2,
                name: 'Jordan',
                phone: '+12105550102',
                role: 'stylist',
                commission: 45,
                schedule: { 2: { open: 10, close: 18 }, 4: { open: 10, close: 18 } },
            },
            {
                id: 3,
                name: 'Alex (Admin)',
                phone: '+12105550103',
                role: 'admin',
                commission: 0,
                schedule: {},
            },
        ];

        const initialClients = [
            {
                id: 1,
                name: 'Jamie Lee',
                phone: '+12105550011',
                email: 'jamie@example.com',
                pets: [
                    { id: 11, name: 'Buddy', breed: 'Golden Retriever', notes: 'Nervous at dryers' },
                    { id: 12, name: 'Milo', breed: 'Poodle Mix', notes: '' },
                ],
            },
            {
                id: 2,
                name: 'Chris P.',
                phone: '+12105550012',
                email: '',
                pets: [{ id: 21, name: 'Daisy', breed: 'Yorkie', notes: '' }],
            },
        ];

        const initialMessages = [
            {
                id: 1,
                from: '+1CLIENT',
                to: '+1SHOP',
                body: 'Hi! Can I book for Daisy on Fri at 10?',
                time: new Date(),
            },
        ];

        // Utility functions
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }
        function formatTime(date) {
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Main App component
        function App() {
            const [page, setPage] = React.useState('home');
            const [services] = React.useState(initialServices);
            const [employees] = React.useState(initialEmployees);
            const [clients] = React.useState(initialClients);
            const [appointments, setAppointments] = React.useState([]);
            const [messages, setMessages] = React.useState(initialMessages);

            // Add appointment
            const addAppointment = (appt) => {
                setAppointments((prev) => [...prev, { id: prev.length + 1, ...appt }]);
            };
            // Mark appointment complete
            const completeAppointment = (id) => {
                setAppointments((prev) =>
                    prev.map((a) => (a.id === id ? { ...a, status: 'complete' } : a))
                );
            };

            return (
                <div>
                    <nav>
                        {['home', 'book', 'calendar', 'clients', 'admin', 'messages'].map((key) => (
                            <button
                                key={key}
                                className={page === key ? 'active' : ''}
                                onClick={() => setPage(key)}
                            >
                                {key.charAt(0).toUpperCase() + key.slice(1)}
                            </button>
                        ))}
                    </nav>
                    <div className="container">
                        {page === 'home' && <Home />}
                        {page === 'book' && (
                            <Book
                                clients={clients}
                                services={services}
                                employees={employees.filter((e) => e.role === 'stylist')}
                                addAppointment={addAppointment}
                            />
                        )}
                        {page === 'calendar' && (
                            <Calendar
                                appointments={appointments}
                                clients={clients}
                                services={services}
                                employees={employees}
                                completeAppointment={completeAppointment}
                            />
                        )}
                        {page === 'clients' && <Clients clients={clients} />}
                        {page === 'admin' && (
                            <Admin
                                appointments={appointments}
                                employees={employees}
                                services={services}
                            />
                        )}
                        {page === 'messages' && (
                            <Messages messages={messages} setMessages={setMessages} />
                        )}
                    </div>
                </div>
            );
        }

        function Home() {
            return (
                <div>
                    <h1>Scruffy Butts</h1>
                    <h2>Natalia, TX</h2>
                    <p>Grooming • Deshedding • TLC</p>
                    <p>
                        Welcome! Use the navigation above to book appointments, view calendar, manage
                        clients, or communicate.
                    </p>
                </div>
            );
        }

        function Book({ clients, services, employees, addAppointment }) {
            const [clientId, setClientId] = React.useState('');
            const [petId, setPetId] = React.useState('');
            const [serviceId, setServiceId] = React.useState('');
            const [employeeId, setEmployeeId] = React.useState('');
            const [datetime, setDatetime] = React.useState('');

            const selectedClient = clients.find((c) => c.id === Number(clientId));
            const pets = selectedClient ? selectedClient.pets : [];

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!clientId || !petId || !serviceId || !employeeId || !datetime) return;
                const svc = services.find((s) => s.id === Number(serviceId));
                const start = new Date(datetime);
                const end = new Date(start.getTime() + svc.duration * 60000);
                addAppointment({
                    clientId: Number(clientId),
                    petId: Number(petId),
                    serviceId: Number(serviceId),
                    employeeId: Number(employeeId),
                    start,
                    end,
                    status: 'booked',
                });
                // Reset
                setClientId('');
                setPetId('');
                setServiceId('');
                setEmployeeId('');
                setDatetime('');
                alert('Appointment booked!');
            };

            return (
                <div>
                    <h2>Book Appointment</h2>
                    <form onSubmit={handleSubmit}>
                        <select value={clientId} onChange={(e) => setClientId(e.target.value)}>
                            <option value="">Select client</option>
                            {clients.map((c) => (
                                <option key={c.id} value={c.id}>
                                    {c.name}
                                </option>
                            ))}
                        </select>
                        <select
                            value={petId}
                            onChange={(e) => setPetId(e.target.value)}
                            disabled={!pets.length}
                        >
                            <option value="">Select pet</option>
                            {pets.map((p) => (
                                <option key={p.id} value={p.id}>
                                    {p.name}
                                </option>
                            ))}
                        </select>
                        <select value={serviceId} onChange={(e) => setServiceId(e.target.value)}>
                            <option value="">Select service</option>
                            {services.map((s) => (
                                <option key={s.id} value={s.id}>
                                    {s.name} ($ {s.price})
                                </option>
                            ))}
                        </select>
                        <select value={employeeId} onChange={(e) => setEmployeeId(e.target.value)}>
                            <option value="">Select stylist</option>
                            {employees.map((e) => (
                                <option key={e.id} value={e.id}>
                                    {e.name}
                                </option>
                            ))}
                        </select>
                        <input
                            type="datetime-local"
                            value={datetime}
                            onChange={(e) => setDatetime(e.target.value)}
                        />
                        <button type="submit">Book</button>
                    </form>
                </div>
            );
        }

        function Calendar({ appointments, clients, services, employees, completeAppointment }) {
            const [filterDate, setFilterDate] = React.useState(formatDate(new Date()));
            const dateAppointments = appointments.filter(
                (a) => formatDate(a.start) === filterDate
            );
            return (
                <div>
                    <h2>Calendar</h2>
                    <input
                        type="date"
                        value={filterDate}
                        onChange={(e) => setFilterDate(e.target.value)}
                    />
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Client & Pet</th>
                                <th>Service</th>
                                <th>Stylist</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {dateAppointments.map((a) => {
                                const client = clients.find((c) => c.id === a.clientId);
                                const pet = client?.pets.find((p) => p.id === a.petId);
                                const svc = services.find((s) => s.id === a.serviceId);
                                const emp = employees.find((e) => e.id === a.employeeId);
                                return (
                                    <tr key={a.id}>
                                        <td>
                                            {formatTime(a.start)}–{formatTime(a.end)}
                                        </td>
                                        <td>
                                            {client?.name} – {pet?.name}
                                        </td>
                                        <td>{svc?.name}</td>
                                        <td>{emp?.name}</td>
                                        <td>{a.status}</td>
                                        <td>
                                            {a.status !== 'complete' && (
                                                <button onClick={() => completeAppointment(a.id)}>
                                                    Complete
                                                </button>
                                            )}
                                        </td>
                                    </tr>
                                );
                            })}
                            {dateAppointments.length === 0 && (
                                <tr>
                                    <td colSpan="6">No appointments on this date.</td>
                                </tr>
                            )}
                        </tbody>
                    </table>
                </div>
            );
        }

        function Clients({ clients }) {
            const [selected, setSelected] = React.useState(null);
            return (
                <div>
                    <h2>Clients</h2>
                    <div style={{ display: 'flex', gap: '20px' }}>
                        <ul style={{ listStyle: 'none', padding: 0 }}>
                            {clients.map((c) => (
                                <li key={c.id}>
                                    <button
                                        onClick={() => setSelected(c)}
                                        style={{ cursor: 'pointer' }}
                                    >
                                        {c.name}
                                    </button>
                                </li>
                            ))}
                        </ul>
                        {selected && (
                            <div>
                                <h3>{selected.name}</h3>
                                <p>Phone: {selected.phone}</p>
                                {selected.email && <p>Email: {selected.email}</p>}
                                <h4>Pets</h4>
                                <ul style={{ paddingLeft: '20px' }}>
                                    {selected.pets.map((p) => (
                                        <li key={p.id}>
                                            <strong>{p.name}</strong> ({p.breed}){' '}
                                            {p.notes && ` – ${p.notes}`}
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function Admin({ appointments, employees, services }) {
            // Compute payroll: only completed appointments
            const payroll = {};
            appointments
                .filter((a) => a.status === 'complete')
                .forEach((a) => {
                    const svc = services.find((s) => s.id === a.serviceId);
                    const empId = a.employeeId;
                    if (!payroll[empId]) {
                        payroll[empId] = { revenue: 0, commission: svc.commission };
                    }
                    payroll[empId].revenue += svc.price;
                });
            return (
                <div>
                    <h2>Admin</h2>
                    <h3>Payroll Summary</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Stylist</th>
                                <th>Revenue</th>
                                <th>Commission %</th>
                                <th>Stylist Earned</th>
                                <th>House Earned</th>
                            </tr>
                        </thead>
                        <tbody>
                            {Object.keys(payroll).length === 0 && (
                                <tr>
                                    <td colSpan="5">No completed appointments.</td>
                                </tr>
                            )}
                            {employees
                                .filter((e) => payroll[e.id])
                                .map((e) => {
                                    const line = payroll[e.id];
                                    const stylistEarned =
                                        line.revenue * (line.commission / 100);
                                    const houseEarned = line.revenue - stylistEarned;
                                    return (
                                        <tr key={e.id}>
                                            <td>{e.name}</td>
                                            <td>${line.revenue.toFixed(2)}</td>
                                            <td>{line.commission}%</td>
                                            <td>${stylistEarned.toFixed(2)}</td>
                                            <td>${houseEarned.toFixed(2)}</td>
                                        </tr>
                                    );
                                })}
                        </tbody>
                    </table>
                    <h3>Employee Schedules</h3>
                    <ul>
                        {employees.map((e) => (
                            <li key={e.id}>
                                <strong>{e.name}</strong>
                                {Object.keys(e.schedule).length === 0 ? (
                                    <span> – No hours set</span>
                                ) : (
                                    <ul>
                                        {Object.entries(e.schedule).map(([day, hrs]) => (
                                            <li key={day}>
                                                {dayNames[day]}: {hrs.open}:00–{hrs.close}:00
                                            </li>
                                        ))}
                                    </ul>
                                )}
                            </li>
                        ))}
                    </ul>
                </div>
            );
        }

        function Messages({ messages, setMessages }) {
            const [input, setInput] = React.useState('');
            const chatRef = React.useRef(null);

            const sendMessage = () => {
                if (!input.trim()) return;
                const newMsg = {
                    id: messages.length + 1,
                    from: '+1SHOP',
                    to: '+1CLIENT',
                    body: input.trim(),
                    time: new Date(),
                };
                setMessages((prev) => [...prev, newMsg]);
                setInput('');
                // Scroll to bottom after sending
                setTimeout(() => {
                    if (chatRef.current) {
                        chatRef.current.scrollTop = chatRef.current.scrollHeight;
                    }
                }, 50);
            };

            return (
                <div>
                    <h2>Messages</h2>
                    <div className="chat-box" ref={chatRef}>
                        {messages.map((m) => (
                            <div
                                key={m.id}
                                className={'message' + (m.from === '+1SHOP' ? ' sent' : '')}
                            >
                                <span>{m.body}</span>
                                <br />
                                <small>{m.time.toLocaleString()}</small>
                            </div>
                        ))}
                    </div>
                    <input
                        type="text"
                        value={input}
                        onChange={(e) => setInput(e.target.value)}
                        placeholder="Type message…"
                        onKeyDown={(e) => {
                            if (e.key === 'Enter') sendMessage();
                        }}
                        style={{ width: '80%' }}
                    />
                    <button onClick={sendMessage} style={{ marginLeft: '10px' }}>
                        Send
                    </button>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>